<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Марина Варфоломеева" />


<title>Анализ мощности</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="my_styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/mathmethr/">Mathmethr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li><a href="index.html">О курсе</a></li>
        <li><a href="lectures.html">Презентации и данные</a></li>
<!--        <li><a href="evaluation_criteria.html">Критерии оценки домашних заданий</a></li>
-->
        <li class="dropdown">
          <a href="appendix" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Полезности<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
<!--             <li><a href="supplement.html">Дополнительные темы</a></li>-->
             <li><a href="resources.html">Ссылки и ресурсы</a></li>
             <li><a href="coding_practices.html">Правила хорошего кода</a></li>
          </ul>
        </li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Анализ мощности</h1>
<h3 class="subtitle">Математические методы в зоологии с использованием R</h3>
<h4 class="author">Марина Варфоломеева</h4>

</div>


<div id="-----" class="section level2">
<h2>Экономим силы с помощью анализа мощности</h2>
<ul>
<li>Тестирование гипотез (двухвыборочный t-критерий)</li>
<li>Статистические ошибки при проверке гипотез</li>
<li>Мощность статистического теста</li>
<li><em>A priori</em> анализ мощности, оценка величины эффекта</li>
<li>Как влиять на мощность тестов</li>
</ul>
<div id="-" class="section level3">
<h3>Вы сможете</h3>
<ul>
<li>сравнивать средние значения при помощи t-критерия, интерпретировать и описывать результаты</li>
<li>дать определение ошибок I и II рода, и графически изобразить их отношение к мощности теста</li>
<li>оценивать величину эффекта и необходимый объем выборки по данным пилотного исследования</li>
<li>загружать данные из .xlsx в R</li>
<li>строить графики средних значений со стандартными отклонениями с помощью <code>ggplot2</code></li>
</ul>
</div>
</div>
<div id="-" class="section level1">
<h1>Тестирование гипотез</h1>
<div id="--t-" class="section level2">
<h2>Тест Стьюдента (t-критерий)</h2>
<p>Гипотезы: <span class="math inline">\(H_0: \mu_1 - \mu_2 = 0\)</span>, <span class="math inline">\(H_A: \mu_1 - \mu_2 \ne 0\)</span></p>
<p>Двухвыборочный тест Стьюдента (Student, 1908) используется для проверки значимости различий между средними значениями двух величин.</p>
<p><span class="math display">\[t= \frac{\bar{x}_1 - \bar{x}_2}{SE_{\bar{x}_1 - \bar{x}_2}}\]</span></p>
<p>Условия применимости:</p>
<ul>
<li>Наблюдения случайны и независимы друг от друга</li>
<li>Выборки случайны и независимы друг от друга</li>
<li>Величины нормально распределены или большая выборка (&gt; 30 наблюдений в группе)</li>
<li><strong>Дисперсии в группах одинаковы</strong></li>
</ul>
<p><span class="math inline">\(SE = \sqrt{\frac{s_1^2(n_1-1) +s_2^2(n_2-1)}{n_1+n_2-2}\Big(\frac{1}{n_1} + \frac{1}{n_2}\Big)}\)</span></p>
<p><span class="math inline">\(df = (n_1 - 1) + (n_2 - 1) = n_1 + n_2 - 2\)</span></p>
</div>
<div id="t----------" class="section level2">
<h2>t-тест Уэлча — это модификация теста Стьюдента <strong>для случая разных дисперсий</strong></h2>
<p><span class="math display">\[t= \frac{\bar{x}_1 - \bar{x}_2}{SE_{\bar{x}_1 - \bar{x}_2}}\]</span></p>
<p>Условия применимости:</p>
<ul>
<li>Наблюдения случайны и независимы друг от друга</li>
<li>Выборки случайны и независимы друг от друга</li>
<li>Величины нормально распределены или большая выборка (&gt; 30 наблюдений в группе)</li>
</ul>
<p><span class="math inline">\(SE = \sqrt{{s_1^2}/ {n_1} + {s_2^2}/{n_2}}\)</span></p>
<p>Приблизительное число степеней свободы рассчитывается по уравнению Уэлча-Саттеруэйта</p>
<p><span class="math inline">\(df_{ Welch-Satterthwaite} \approx \cfrac {({s^2_{1}}/{n_{1}} + {s^2_{x_2}}/{n_{2}})^2} {\frac{1}{n_{1} - 1}\bigg(\frac {s_{1}^2} {n_{1}}\bigg)^2 + \frac{1}{n_{2} - 1}\bigg(\frac {s_{2}^2} {n_{2}}\bigg)^2}\)</span></p>
</div>
<div id="t---------" class="section level2">
<h2>t-распределение — распределение разницы средних для выборок из одной совокупности</h2>
<p>t-статистика подчиняется t-распределению.</p>
<p>Иными словами, если много раз взять выборки <strong>из одной</strong> совокупности (т.е. при условии, что <span class="math inline">\(H_0\)</span> верна) и посчитать между ними разницу, то она будет подчиняться t-распределению.</p>
<p>Форма t-распределения зависит только от одного параметра — числа степеней свободы <span class="math inline">\(df\)</span></p>
<embed src="02_power_files/figure-html/gg-t-1.pdf" width="739.2" type="application/pdf" />
</div>
<div id="------" class="section level2">
<h2>В хвостах этого распределения находятся редкие значения</h2>
<embed src="02_power_files/figure-html/gg-tcrit-1.pdf" width="739.2" type="application/pdf" />
<p>Обычно используется уровень значимости <span class="math inline">\(\alpha\)</span> 0.05 или 0.01.</p>
<p><strong>Уровень значимости <span class="math inline">\(\alpha\)</span> — это вероятность ошибочно отвергнуть справедливую нулевую гипотезу</strong>. Т.е. это вероятность найти различия там, где их нет (<strong>вероятность ошибки I рода</strong>).</p>
<p>Для t-теста <span class="math inline">\(\alpha\)</span> — это вероятность ошибочно сделать вывод о том, что средние выборок различаются <strong>при условии, что эти выборки получены из одной генеральной совокупности</strong>.</p>
</div>
<div id="--------t-" class="section level2">
<h2>Тестирование гипотезы о равенстве двух средних при помощи t-теста</h2>
<embed src="02_power_files/figure-html/gg-tcrit-h-1.pdf" width="739.2" type="application/pdf" />
<ol style="list-style-type: decimal">
<li>Для конкретных данных считаем значение t-критерия</li>
<li>Сравниваем его с теоретическим распределением t (распределением при условии, что <span class="math inline">\(H_0\)</span> верна)</li>
<li>Принимаем решение, отвергнуть ли <span class="math inline">\(H_0\)</span></li>
</ol>
</div>
<div id="----" class="section level2">
<h2>Пример: Гормоны и артериальная гипертензия</h2>
<p>Синдром Кушинга — это нарушения уровня артериального давления, вызванные гиперсекрецией кортизола надпочечниками.</p>
<p>В датасете <code>Cushings</code> (пакет <code>MASS</code>) записаны данные о секреции двух метаболитов при разных типах синдрома (данные из кн. Aitchison, Dunsmore, 1975).</p>
<ul>
<li><code>Tetrahydrocortisone</code> — секреция тетрагидрокортизона с мочой (мг/сут.)</li>
<li><code>Pregnanetriol</code> — секреция прегнантриола с мочой (мг/сут.)</li>
<li><code>Type</code> — тип синдрома:
<ul>
<li><code>a</code> — аденома</li>
<li><code>b</code> — двусторонняя гиперплазия</li>
<li><code>c</code> — карцинома</li>
<li><code>u</code> — не известно</li>
</ul></li>
</ul>
<p>Различается ли секреция тетрагидрокортизона при аденома и двусторонней гиперплазии надпочечников?</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(MASS)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">data</span>(<span class="st">&quot;Cushings&quot;</span>)</a></code></pre></div>
</div>
<div id="-t---r---t.test" class="section level2">
<h2>Двухвыборочный t-критерий в R рассчитывает функция <code>t.test()</code></h2>
<p>О параметрах функции t.test() можно прочесть в справке <code>?t.test</code></p>
<p>Формат вызова функции, если в данных две группы</p>
<pre><code>t.test(formula = зависимая_переменная ~ группирующая_переменная, data = данные, ...)</code></pre>
<p>Если групп больше двух — другой формат</p>
<pre><code>t.test(x = одна_группа, y = другая_группа, ...)</code></pre>
</div>
<div id="---------" class="section level2">
<h2>Различается ли секреция тетрагидрокортизона при аденома и двусторонней гиперплазии надпочечников?</h2>

<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">tt &lt;-<span class="st"> </span><span class="kw">t.test</span>(<span class="dt">formula =</span> Tetrahydrocortisone <span class="op">~</span><span class="st"> </span>Type, <span class="dt">data =</span> Cushings, </a>
<a class="sourceLine" id="cb4-2" data-line-number="2">             <span class="dt">subset =</span> Cushings<span class="op">$</span>Type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;a&#39;</span>, <span class="st">&#39;b&#39;</span>))</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">tt</a></code></pre></div>
<pre><code># 
#   Welch Two Sample t-test
# 
# data:  Tetrahydrocortisone by Type
# t = -4.1499, df = 10.685, p-value = 0.001719
# alternative hypothesis: true difference in means is not equal to 0
# 95 percent confidence interval:
#  -7.988307 -2.438360
# sample estimates:
# mean in group a mean in group b 
#        2.966667        8.180000</code></pre>

<p>Результаты можно описать, например, так:</p>
<ul>
<li>Секреция тетрагидрокортизона значимо различается у пациентов с аденомой и двусторонней гиперплазией надпочечников (<span class="math inline">\(t_{10.69} = -4.15\)</span>, <span class="math inline">\(p = &lt; 0.05\)</span>)</li>
</ul>
</div>
<div id="---" class="section level2">
<h2>Что спрятано в результатах?</h2>
<p>Как называются отдельные элементы результатов можно узнать посмотрев их структуру при помощи функции <code>str()</code></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">str</span>(tt)</a></code></pre></div>
<pre><code># List of 10
#  $ statistic  : Named num -4.15
#   ..- attr(*, &quot;names&quot;)= chr &quot;t&quot;
#  $ parameter  : Named num 10.7
#   ..- attr(*, &quot;names&quot;)= chr &quot;df&quot;
#  $ p.value    : num 0.00172
#  $ conf.int   : num [1:2] -7.99 -2.44
#   ..- attr(*, &quot;conf.level&quot;)= num 0.95
#  $ estimate   : Named num [1:2] 2.97 8.18
#   ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;mean in group a&quot; &quot;mean in group b&quot;
#  $ null.value : Named num 0
#   ..- attr(*, &quot;names&quot;)= chr &quot;difference in means&quot;
#  $ stderr     : num 1.26
#  $ alternative: chr &quot;two.sided&quot;
#  $ method     : chr &quot;Welch Two Sample t-test&quot;
#  $ data.name  : chr &quot;Tetrahydrocortisone by Type&quot;
#  - attr(*, &quot;class&quot;)= chr &quot;htest&quot;</code></pre>
</div>
<div id="-------" class="section level2">
<h2>Можно получить элементы результатов в виде отдельных цифр</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">tt<span class="op">$</span>parameter <span class="co"># степени свободы</span></a></code></pre></div>
<pre><code>#       df 
# 10.68512</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">tt<span class="op">$</span>p.value <span class="co"># уровень значимости</span></a></code></pre></div>
<pre><code># [1] 0.00171934</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">tt<span class="op">$</span>statistic <span class="co"># значение t-критерия</span></a></code></pre></div>
<pre><code>#         t 
# -4.149899</code></pre>
</div>
</div>
<div id="----" class="section level1">
<h1>Статистические ошибки при проверке гипотез</h1>
<div id="----" class="section level2">
<h2>Типы ошибок при проверке гипотез</h2>
<table>
<thead>
<tr class="header">
<th></th>
<th><span class="math display">\[H0 == TRUE\]</span></th>
<th><span class="math display">\[H0 == FALSE\]</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Отклонить <span class="math inline">\(H_0\)</span></td>
<td>Ошибка I рода</td>
<td>Верно</td>
</tr>
<tr class="even">
<td>Сохранить <span class="math inline">\(H_0\)</span></td>
<td>Верно</td>
<td>Ошибка II рода</td>
</tr>
</tbody>
</table>
</div>
<div id="-i-" class="section level2">
<h2>Ошибка I рода</h2>

<table>
<thead>
<tr class="header">
<th></th>
<th><span class="math display">\[H0 == TRUE\]</span></th>
<th><span class="math display">\[H0 == FALSE\]</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Отклонить <span class="math inline">\(H_0\)</span></td>
<td>Ошибка I рода</td>
<td>Верно</td>
</tr>
<tr class="even">
<td>Сохранить <span class="math inline">\(H_0\)</span></td>
<td>Верно</td>
<td>Ошибка II рода</td>
</tr>
</tbody>
</table>

<embed src="02_power_files/figure-html/power_alpha-1.pdf" width="969.6" type="application/pdf" />
<p><strong>Ошибка I рода — вероятность отвергнуть <span class="math inline">\(H_0\)</span>, когда верна <span class="math inline">\(H_0\)</span></strong></p>
</div>
<div id="--------h_a" class="section level2">
<h2>Мы этого не знаем, но может быть верна <span class="math inline">\(H_A\)</span>…</h2>

<table>
<thead>
<tr class="header">
<th></th>
<th><span class="math display">\[H0 == TRUE\]</span></th>
<th><span class="math display">\[H0 == FALSE\]</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Отклонить <span class="math inline">\(H_0\)</span></td>
<td>Ошибка I рода</td>
<td>Верно</td>
</tr>
<tr class="even">
<td>Сохранить <span class="math inline">\(H_0\)</span></td>
<td>Верно</td>
<td>Ошибка II рода</td>
</tr>
</tbody>
</table>

<embed src="02_power_files/figure-html/power_alternative-1.pdf" width="969.6" type="application/pdf" />
<p>Можно построить еще одно распределение статистики — распределение, при условии того, что верна <span class="math inline">\(H_A\)</span></p>
</div>
<div id="-ii-" class="section level2">
<h2>Ошибка II рода</h2>

<table>
<thead>
<tr class="header">
<th></th>
<th><span class="math display">\[H0 == TRUE\]</span></th>
<th><span class="math display">\[H0 == FALSE\]</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Отклонить <span class="math inline">\(H_0\)</span></td>
<td>Ошибка I рода</td>
<td>Верно</td>
</tr>
<tr class="even">
<td>Сохранить <span class="math inline">\(H_0\)</span></td>
<td>Верно</td>
<td>Ошибка II рода</td>
</tr>
</tbody>
</table>

<embed src="02_power_files/figure-html/power_beta-1.pdf" width="969.6" type="application/pdf" />
<p><strong>Ошибка II рода — вероятность принять <span class="math inline">\(H_0\)</span>, когда верна</strong> <span class="math inline">\(H_A\)</span></p>
</div>
<div id="----" class="section level2">
<h2>Мощность теста — способность выявлять различия</h2>

<table>
<thead>
<tr class="header">
<th></th>
<th><span class="math display">\[H0 == TRUE\]</span></th>
<th><span class="math display">\[H0 == FALSE\]</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Отклонить <span class="math inline">\(H_0\)</span></td>
<td>Ошибка I рода</td>
<td>Верно</td>
</tr>
<tr class="even">
<td>Сохранить <span class="math inline">\(H_0\)</span></td>
<td>Верно</td>
<td>Ошибка II рода</td>
</tr>
</tbody>
</table>

<embed src="02_power_files/figure-html/power-power-1.pdf" width="969.6" type="application/pdf" />
<p><strong>Мощность теста - вероятность отвергнуть <span class="math inline">\(H_0\)</span>, когда верна</strong> <span class="math inline">\(H_A\)</span></p>
<p><span class="math display">\[Power = 1 - \beta\]</span></p>
</div>
<div id="-" class="section level2">
<h2>Мощность теста</h2>
<p><span class="math display">\[Power = 1 - \beta\]</span></p>
<p>Обычно считается, что хорошо, когда мощность не меньше 0.8</p>
<p>Т.е. что в 80% случаев мы можем найди различия заданной величины, если они есть.</p>
<embed src="02_power_files/figure-html/power-power-1.pdf" width="969.6" type="application/pdf" />
</div>
<div id="-" class="section level2">
<h2>Анализ мощности</h2>


<p><em>A priori</em></p>
<ul>
<li>какой нужен объем выборки, чтобы найти различия с разумной долей уверенности?</li>
<li>различия какой величины мы можем найти, если известен объем выборки?</li>
</ul>

<p><em>Post hoc</em></p>
<ul>
<li>смогли бы мы найти различия при помощи нашего эксперимента (<span class="math inline">\(\alpha\)</span>, <span class="math inline">\(n\)</span>), если бы величина эффекта была <span class="math inline">\(X\)</span>?</li>
</ul>

</div>
</div>
<div id="a-priory--" class="section level1">
<h1>A priory анализ мощности</h1>
<div id="a-priori--" class="section level2">
<h2>A priori анализ мощности</h2>


<p>Что нужно</p>
<ul>
<li>тест</li>
<li>уровень значимости</li>
<li>желаемая мощность теста</li>
<li>ожидаемая величина эффекта</li>
</ul>


<p>Что есть</p>
<ul>
<li><span class="math inline">\(t\)</span>-критерий</li>
<li><span class="math inline">\(\alpha = 0.05\)</span></li>
<li><span class="math inline">\(Power = 0.8\)</span></li>
<li>?</li>
</ul>

</div>
<div id="-" class="section level2">
<h2>Величина эффекта</h2>
<p><span class="math inline">\(d\)</span> Коэна (Cohen’s d)</p>
<p><span class="math display">\[d = \frac{\bar x_1 - \bar x_2}{SD_{pooled}}\]</span></p>
<p>где <span class="math inline">\(SD_{pooled}\)</span> — обобщенное стандартное отклонение</p>
<p><span class="math inline">\(SD_{pooled} = {\sqrt{\frac {(n _1 - 1)s_1^2 + (n _2 - 1)s_2^2 } {n _1 + n _2 - 2} } }\)</span></p>
</div>
<div id="--1" class="section level2">
<h2>Величина эффекта</h2>
<p>Яков Коэн предложил делить эффекты на сильные, умеренные и слабые (Cohen, 1982)</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">library</span>(pwr)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw">cohen.ES</span>(<span class="dt">test =</span> <span class="st">&#39;t&#39;</span>, <span class="dt">size =</span> <span class="st">&#39;large&#39;</span>)</a></code></pre></div>
<pre><code># 
#      Conventional effect size from Cohen (1982) 
# 
#            test = t
#            size = large
#     effect.size = 0.8</code></pre>
</div>
<div id="-------" class="section level2">
<h2>Расчет объема выборки для обнаружения эффекта известной величины</h2>
<p>Функции для анализа мощности t-критерия:</p>
<ul>
<li>при одинаковых объемах групп <code>pwr.t.test()</code></li>
<li>при разных объемах групп <code>pwr.t2n.test()</code></li>
</ul>
<p>Какая нужна выборка, чтобы обнаружить <em>сильный эффект</em> с вероятностью 0.8 при уровне значимости 0.05?</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">pwr.t.test</span>(<span class="dt">n =</span> <span class="ot">NULL</span>, <span class="dt">d =</span> <span class="fl">0.8</span>, <span class="dt">power =</span> <span class="fl">0.8</span>, <span class="dt">sig.level =</span> <span class="fl">0.01</span>,</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">           <span class="dt">type =</span> <span class="st">&#39;two.sample&#39;</span>, <span class="dt">alternative =</span> <span class="st">&#39;two.sided&#39;</span>)</a></code></pre></div>
<pre><code># 
#      Two-sample t test power calculation 
# 
#               n = 38.18831
#               d = 0.8
#       sig.level = 0.01
#           power = 0.8
#     alternative = two.sided
# 
# NOTE: n is number in *each* group</code></pre>
</div>
<div class="section level2">
<h2>Задание</h2>
<p>Какая нужна выборка, чтобы обнаружить <em>слабый эффект</em> с вероятностью 0.8 при уровне значимости 0.05?</p>
<p>Вам понадобятся функции <code>cohen.ES()</code> и <code>pwr.t.test()</code></p>
</div>
<div class="section level2">
<h2>Решение</h2>

<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">cohen.ES</span>(<span class="dt">test =</span> <span class="st">&#39;t&#39;</span>, <span class="dt">size =</span> <span class="st">&#39;small&#39;</span>) <span class="co"># величина слабого эффекта по Коэну</span></a></code></pre></div>
<pre><code># 
#      Conventional effect size from Cohen (1982) 
# 
#            test = t
#            size = small
#     effect.size = 0.2</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co"># Какой нужен объем выборки?</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="kw">pwr.t.test</span>(<span class="dt">n =</span> <span class="ot">NULL</span>, <span class="dt">d =</span> <span class="fl">0.2</span>, <span class="dt">power =</span> <span class="fl">0.8</span>, <span class="dt">sig.level =</span> <span class="fl">0.05</span>,</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">           <span class="dt">type =</span> <span class="st">&#39;two.sample&#39;</span>, <span class="dt">alternative =</span> <span class="st">&#39;two.sided&#39;</span>)</a></code></pre></div>
<pre><code># 
#      Two-sample t test power calculation 
# 
#               n = 393.4057
#               d = 0.2
#       sig.level = 0.05
#           power = 0.8
#     alternative = two.sided
# 
# NOTE: n is number in *each* group</code></pre>
<p>Для того, чтобы при помощи t-теста обнаружить слабый эффект (d = 0.2) с вероятностью 0.8 и при уровне значимости 0.05, нужно собрать выборку не меньше 394 наблюдений <strong>в каждой</strong> группе.</p>
</div>
</div>
<div id="a-priory------" class="section level1">
<h1>A priory анализ мощности по данным пилотного исследования</h1>
<div id="---" class="section level2">
<h2>Пример: Морфометрия жуков-листоедов</h2>
<p>Измерения 43 самцов жуков-листоедов двух видов жуков из подсемейства козявок (Galerucinae) в семействе листоедов (Chrysomelidae): <em>Chaetocnema concinna</em>, <em>Ch. heptapotamica</em>.</p>
<p>Переменные</p>
<ul>
<li>fjft — ширина первого членика первой лапки в микронах (сумма измерений для обеих лапок)</li>
<li>species — вид жуков (1=Ch. concinna, 2= Ch. heptapotamica)</li>
</ul>
<p>Есть ли морфологические различия между видами?</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">library</span>(readxl)</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">flea &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="dt">path =</span> <span class="st">&#39;data/fleabeetles-subset.xlsx&#39;</span>, <span class="dt">sheet =</span> <span class="st">&#39;dat&#39;</span>)</a></code></pre></div>

<p>Фрагмент данных из работы Lubischew, A.A., 1962. On the use of discriminant functions in taxonomy. Biometrics, pp.455-477.</p>
</div>
<div id="---" class="section level2">
<h2>Все ли правильно открылось?</h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">str</span>(flea)  <span class="co"># Структура данных</span></a></code></pre></div>
<pre><code># Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;: 43 obs. of  2 variables:
#  $ fjft   : num  191 185 200 173 171 160 188 186 174 163 ...
#  $ species: num  1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw">head</span>(flea) <span class="co"># Первые несколько строк файла</span></a></code></pre></div>
<pre><code># # A tibble: 6 x 2
#    fjft species
#   &lt;dbl&gt;   &lt;dbl&gt;
# 1   191       1
# 2   185       1
# 3   200       1
# 4   173       1
# 5   171       1
# 6   160       1</code></pre>
</div>
<div id="-----" class="section level2">
<h2>Делаем фактором переменную, где записан вид</h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">flea<span class="op">$</span>species &lt;-<span class="st"> </span><span class="kw">factor</span>(flea<span class="op">$</span>species, </a>
<a class="sourceLine" id="cb27-2" data-line-number="2">                       <span class="dt">levels =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), </a>
<a class="sourceLine" id="cb27-3" data-line-number="3">                       <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;cocin&#39;</span>, <span class="st">&#39;hept&#39;</span>))</a></code></pre></div>
</div>
<div id="--" class="section level2">
<h2>Знакомимся с данными</h2>
<p>Есть ли пропущенные значения?</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw">colSums</span>(<span class="kw">is.na</span>(flea))</a></code></pre></div>
<pre><code>#    fjft species 
#       0       0</code></pre>
<p>Каковы объемы выборок? Поскольку нет пропущенных значений, можно посчитать так</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw">table</span>(flea<span class="op">$</span>species)</a></code></pre></div>
<pre><code># 
# cocin  hept 
#    21    22</code></pre>
</div>
<div id="-----." class="section level2">
<h2>Представим, что это данные пилотного исследования.</h2>
<p>Мы хотим выяснить, сколько нужно жуков, чтобы показать, что ширина первого членика первой лапки различается у этих двух видов</p>
<p>График средних и стандартных отклонений</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="kw">theme_set</span>(<span class="kw">theme_bw</span>())</a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="kw">ggplot</span>(<span class="dt">data =</span> flea, <span class="kw">aes</span>(<span class="dt">x =</span> species, <span class="dt">y =</span> fjft)) <span class="op">+</span></a>
<a class="sourceLine" id="cb32-4" data-line-number="4"><span class="st">  </span><span class="kw">stat_summary</span>(<span class="dt">geom =</span> <span class="st">&#39;pointrange&#39;</span>, <span class="dt">fun.data =</span> mean_sdl) <span class="op">+</span></a>
<a class="sourceLine" id="cb32-5" data-line-number="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&#39;Ширина первого членика </span><span class="ch">\n</span><span class="st">первой лапки (мкм)&#39;</span>, <span class="dt">x =</span> <span class="st">&#39;Вид&#39;</span>)</a></code></pre></div>
<embed src="02_power_files/figure-html/unnamed-chunk-13-1.pdf" width="5cm" height="4cm" type="application/pdf" />
</div>
<div id="----" class="section level2">
<h2>Величина эффекта по исходным данным</h2>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw">library</span>(effsize)</a>
<a class="sourceLine" id="cb33-2" data-line-number="2">eff_flea &lt;-<span class="st"> </span><span class="kw">cohen.d</span>(<span class="dt">d =</span> flea<span class="op">$</span>fjft, <span class="dt">f =</span> flea<span class="op">$</span>species)</a>
<a class="sourceLine" id="cb33-3" data-line-number="3">eff_flea</a></code></pre></div>
<pre><code># 
# Cohen&#39;s d
# 
# d estimate: 4.153819 (large)
# 95 percent confidence interval:
#    lower    upper 
# 3.059340 5.248298</code></pre>
<p>Вычислим модуль, поскольку для <code>pwr.t.test()</code> эффект должен быть положительным</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">effect_size_flea &lt;-<span class="st"> </span><span class="kw">abs</span>(eff_flea<span class="op">$</span>estimate)</a></code></pre></div>
</div>
<div id="-1" class="section level2">
<h2>Задание</h2>
<p>Рассчитайте объем выборки, чтобы показать различия размеров с вероятностью 0.8 на уровне значимости 0.05</p>
<p>Используйте функцию <code>pwr.t.test()</code></p>
</div>
<div id="-1" class="section level2">
<h2>Решение</h2>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">pwr_flea &lt;-<span class="st"> </span><span class="kw">pwr.t.test</span>(<span class="dt">n =</span> <span class="ot">NULL</span>, <span class="dt">d =</span> effect_size_flea, </a>
<a class="sourceLine" id="cb36-2" data-line-number="2">                       <span class="dt">power =</span> <span class="fl">0.8</span>, <span class="dt">sig.level =</span> <span class="fl">0.05</span>, </a>
<a class="sourceLine" id="cb36-3" data-line-number="3">                       <span class="dt">type =</span> <span class="st">&#39;two.sample&#39;</span>, </a>
<a class="sourceLine" id="cb36-4" data-line-number="4">                       <span class="dt">alternative =</span> <span class="st">&#39;two.sided&#39;</span>)</a>
<a class="sourceLine" id="cb36-5" data-line-number="5">pwr_flea</a></code></pre></div>
<pre><code># 
#      Two-sample t test power calculation 
# 
#               n = 2.354027
#               d = 4.153819
#       sig.level = 0.05
#           power = 0.8
#     alternative = two.sided
# 
# NOTE: n is number in *each* group</code></pre>

<ul>
<li>Нужна выборка из <strong>3 жуков каждого вида</strong>, чтобы с вероятностью 0.8 обнаружить различия размеров между видами.</li>
</ul>
</div>
</div>
<div id="----" class="section level1">
<h1>Как влиять на мощность теста?</h1>
<div id="------" class="section level2">
<h2>Чем больше объем выборки — тем больше мощность</h2>
<embed src="02_power_files/figure-html/pwr_vs_n-1.pdf" width="960" type="application/pdf" />
</div>
<div id="------" class="section level2">
<h2>Чем больше уровень значимости — тем больше мощность</h2>
<embed src="02_power_files/figure-html/unnamed-chunk-17-1.pdf" width="960" type="application/pdf" />
</div>
<div id="------" class="section level2">
<h2>Чем больше величина различий — тем больше мощность</h2>
<embed src="02_power_files/figure-html/unnamed-chunk-18-1.pdf" width="960" type="application/pdf" />
</div>
<div id="------" class="section level2">
<h2>Каким образом можно повлиять на мощность теста?</h2>
<ul>
<li>Мощность теста можно регулировать, если
<ul>
<li>изменить число повторностей</li>
<li>выбрать другой уровень значимости (<span class="math inline">\(\alpha\)</span>)</li>
<li>определиться, какие эффекты действительно важны (<span class="math inline">\(ES\)</span>)</li>
</ul></li>
</ul>
</div>
<div id="take-home-messages" class="section level2">
<h2>Take-home messages</h2>
<ul>
<li>Чтобы не находить несуществующих эффектов, фиксируем уровень значимости</li>
<li>Чтобы не пропустить значимое, рассчитываем величину эффекта, объем выборки и мощность теста</li>
<li>Способность выявлять различия зависит
<ul>
<li>от объема выборки,</li>
<li>от уровня значимости</li>
<li>от величины эффекта</li>
</ul></li>
</ul>
</div>
<div id="-" class="section level2">
<h2>Дополнительные ресурсы</h2>
<ul>
<li>Quinn, Keough, 2002, pp. 164-170</li>
<li>OpenIntro: Statistics</li>
<li>Sokal, Rohlf, 1995, pp. 167-169.</li>
<li>Zar, 1999, p. 83.</li>
<li><a href="http://www.ats.ucla.edu/stat/r/dae/t_test_power2.htm">R Data Analysis Examples - Power Analysis for Two-group Independent sample t-test. UCLA: Statistical Consulting Group.</a></li>
<li><a href="http://www.ats.ucla.edu/stat/r/dae/t_test_power.htm">R Data Analysis Examples - Power Analysis for One-sample t-test. UCLA: Statistical Consulting Group.</a></li>
<li><a href="http://www.ats.ucla.edu/stat/mult_pkg/faq/general/effect_size_power/effect_size_power.htm">FAQ - How is effect size used in power analysis? UCLA: Statistical Consulting Group.</a></li>
</ul>
</div>
</div>

<p><small>
<!--
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">mathmethr</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="varmara.github.io/mathmethr-course" property="cc:attributionName" rel="cc:attributionURL">Marina Varfolomeeva</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
-->
</small></p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
